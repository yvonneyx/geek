# HTML解析

## 第一步
- 为了方便文件管理， 把parser单独拆到文件中
- parseHTML接受HTML文本作为参数返回DOM树

## 第二步
- 我们用FSM来实现HTML的分析（状态机）
- 在HTML的标准中，已经规定了HTML的状态
- Toy-Browser只挑选其中一部分状态，完成一个最简版本

## 第三步：解析标签
- 主要标签有： 开始标签、结束标签、自封闭标签

> \t 结束符 \n 换行符 \f 禁止符

## 第四步：创建元素
- 在状态机中，除了状态迁移，还要加入业务逻辑
- 我们在标签结束状态提交标签token

## 第五步：处理标签属性
- 属性分为单引号 双引号 无引号三种写法，因此需要比较多的状态
- 处理方式和标签类似

## 第六步：用Token构建DOM树 

> 在emit(token)中实现

- 从标签构建DOM树的基本技巧就是使用**栈**
- 遇到开始标签创建元素入栈，遇到结束标签出栈
- 自封闭节点可视为入栈后立即出栈
- 任何元素的父元素是他入栈前的栈顶

```jsx
top.children.push(element);
element.parent = top;
```

## 第七步：将文本节点加到DOM树

> token一个一个传，所以多个文本节点需要合并 —— 将先emit再push到currentTextNode.content

- 文本节点与自封闭标签类似处理类似，不会真的入栈
- 多个文本节点需要合并